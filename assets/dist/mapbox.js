!function(t){"function"==typeof define&&define.amd?define("mapbox",t):t()}(function(){"use strict";Voxel.Maps.Autocomplete=function(t,e,o={}){this.init(t,e,o)},Voxel.Maps.Bounds=function(t,e){this.southwest=t,this.northeast=e,this.init(t,e)},Voxel.Maps.Bounds.prototype.extend=function(t){},Voxel.Maps.Bounds.prototype.empty=function(){},Voxel.Maps.Bounds.prototype.getSourceObject=function(){},Voxel.Maps.Bounds.prototype.getSouthWest=function(){return this.southwest},Voxel.Maps.Bounds.prototype.getNorthEast=function(){return this.northeast},Voxel.Maps.Geocoder=function(){this.init()},Voxel.Maps.getGeocoder=function(){return Voxel.Maps._geocoder||(Voxel.Maps._geocoder=new Voxel.Maps.Geocoder),Voxel.Maps._geocoder},Voxel.Maps.Geocoder.prototype.geocode=function(t,e,o){},Voxel.Maps.Geocoder.prototype.formatFeature=function(t){},Voxel.Maps.Geocoder.prototype.getUserLocation=function({fetchAddress:e=!0,receivedPosition:o=t=>{},receivedAddress:n=t=>{},positionFail:t=()=>{},addressFail:s=()=>{}}={}){if(!navigator.geolocation)return t();navigator.geolocation.getCurrentPosition(t=>{t=new Voxel.Maps.LatLng(t.coords.latitude,t.coords.longitude);o(t),!1!==e&&Voxel.Maps.getGeocoder().geocode(t.toGeocoderFormat(),t=>t?n(t):(Voxel.alert(Voxel_Config.l10n.positionFail,"error"),s()))},()=>t())},Voxel.Maps.LatLng=function(t,e){this.init(t,e)},Voxel.Maps.LatLng.prototype.getLatitude=function(){},Voxel.Maps.LatLng.prototype.getLongitude=function(){},Voxel.Maps.LatLng.prototype.getSourceObject=function(){},Voxel.Maps.LatLng.prototype.toGeocoderFormat=function(){},Voxel.Maps.Map=function({el:t,zoom:e=10,center:o=new Voxel.Maps.LatLng(Voxel_Config.maps.default_lat,Voxel_Config.maps.default_lng),minZoom:n=4,maxZoom:s=16,draggable:a=!0}){this.init({el:t,zoom:e,center:o,minZoom:n,maxZoom:s,draggable:a})},Voxel.Maps.Map.prototype.setZoom=function(t){},Voxel.Maps.Map.prototype.getZoom=function(){},Voxel.Maps.Map.prototype.getMinZoom=function(){},Voxel.Maps.Map.prototype.getMaxZoom=function(){},Voxel.Maps.Map.prototype.setCenter=function(t){},Voxel.Maps.Map.prototype.getCenter=function(){},Voxel.Maps.Map.prototype.fitBounds=function(t){},Voxel.Maps.Map.prototype.panTo=function(t){},Voxel.Maps.Map.prototype.getClickPosition=function(t){},Voxel.Maps.Map.prototype.addListener=function(t,e){},Voxel.Maps.Map.prototype.addListenerOnce=function(t,e){},Voxel.Maps.Map.prototype.removeListener=function(t){},Voxel.Maps.Map.prototype.trigger=function(t){},Voxel.Maps.Map.prototype.mapEvent=function(t){return void 0!==this.eventMap[t]?this.eventMap[t]:t},Voxel.Maps.Map.prototype.removeMarkers=function(){for(var t=0;t<this.markers.length;t++)this.markers[t].remove();this.markers=[]},Voxel.Maps.Map.prototype.getSourceObject=function(){},Voxel.Maps.Marker=function({map:t=null,position:e=null,onClick:o=null,template:n=null}){this.template=n,this.init({map:t,position:e,onClick:o})},Voxel.Maps.Marker.prototype.getPosition=function(){},Voxel.Maps.Marker.prototype.setPosition=function(t){},Voxel.Maps.Marker.prototype.getMap=function(){},Voxel.Maps.Marker.prototype.setMap=function(t){},Voxel.Maps.Marker.prototype.remove=function(){},Voxel.Maps.Marker.prototype.addClass=function(){},Voxel.Maps.Marker.prototype.removeClass=function(){},Voxel.Maps.Marker.prototype.getTemplate=function(){var t=this.template||'<div class="map-marker marker-type-icon"><i class="las la-map-marker"></i></div>';return jQuery(`<div class="marker-wrapper">${t}</div>`)},Voxel.Maps.Popup=function({map:t=null,position:e=null,content:o=null}){this.init({map:t,position:e,content:o})},Voxel.Maps.Popup.prototype.init=function(t){},Voxel.Maps.Popup.prototype.setContent=function(t){},Voxel.Maps.Popup.prototype.setPosition=function(t){},Voxel.Maps.Popup.prototype.setMap=function(t){},Voxel.Maps.Popup.prototype.show=function(){},Voxel.Maps.Popup.prototype.hide=function(){},Voxel.Maps.Circle=function({map:t=null,center:e=null,radius:o=null,visible:n=null,className:s="map-circle"}){this.init({map:t,center:e,radius:o,visible:n,className:s})};(function(t){function e(t){if(t=Object.assign({},t),!(this instanceof e))throw new Error("MapboxLanguage needs to be called with the new keyword");this.setLanguage=this.setLanguage.bind(this),this._defaultLanguage=t.defaultLanguage,this._isLanguageField=t.languageField||/^name_/,this._getLanguageField=t.getLanguageField||function(t){return"mul"===t?"name":"name_"+t},this._languageSource=t.languageSource||null,this._languageTransform=t.languageTransform,this._excludedLayerIds=t.excludedLayerIds||[],this.supportedLanguages=t.supportedLanguages||["de","en","fr","it","nl","az","bn","ca","cs","da","el","fa","fi","ga","hu","id","is","ja","ka","km","ko","lo","lv","mn","pt","ro","sq","th","tl","vi","zh","zh_Hans","zh_TW","ar","bs","es","gu","he","hi","kk","lt","my","nb","pl","sk","sr","sv","te","tk","tr","zh_Hant"]}const n=/^\{name/;function a(t,e){var o=Array.isArray(e)&&"get"===e[0];return o&&n.test(e[1])&&console.warn("This plugin no longer supports the use of token syntax (e.g. {name}). Please use a get expression. See https://docs.mapbox.com/mapbox-gl-js/style-spec/expressions/ for more details."),o&&t.test(e[1])}function u(t,e,o){return a(t,e)&&(e[1]=o),function e(o,n,s){if(Array.isArray(n))for(let t=1;t<n.length;t++)Array.isArray(n[t])&&(a(o,n[t])&&(n[t][1]=s),e(o,n[t],s))}(t,e,o),e="get"===e[0]&&"name"===e[1]?["coalesce",["get",o],e.slice()]:e}e.prototype.setLanguage=function(t,e){if(this.supportedLanguages.indexOf(e)<0)throw new Error(`Language ${e} is not supported`);const a=this._languageSource||function(e){var t=Object.keys(e.sources).filter(t=>{t=e.sources[t].url;return t&&-1<t.indexOf("mapbox.mapbox-streets-v8")||/mapbox-streets-v[1-9][1-9]/.test(t)});if(t.length)return t[0];throw new Error('If using MapboxLanguage with a Mapbox style, the style must be based on vector tile version 8, e.g. "streets-v11"')}(t);if(!a)return t;const i=this._getLanguageField(e),p=this._isLanguageField,r=this._excludedLayerIds;var o=t.layers.map(t=>{var e,o,n,s;return t.source===a?(e=p,o=t,n=i,s=r,o.layout&&o.layout["text-field"]&&-1===s.indexOf(o.id)?Object.assign({},o,{layout:Object.assign({},o.layout,{"text-field":u(e,o.layout["text-field"],n)})}):o):t}),t=Object.assign({},t,{layers:o});return this._languageTransform?this._languageTransform(t,e):t},t.exports=e})(t={exports:{}});var t,a=t.exports;Voxel.Maps.Autocomplete.prototype.init=function(t,e,o){!t instanceof Element||(this.el=t,this.onChange=e,this.input=jQuery(this.el),this.focusedItem=0,this.hasQueried=!1,this.options=o,this.attachDropdown(),this.input.on("input",Voxel.helpers.debounce(this.querySuggestions.bind(this),300)),this.input.on("focusin",this.showDropdown.bind(this)),this.input.on("focusout",this.hideDropdown.bind(this)),this.input.on("keydown click",this.navigateDropdown.bind(this)),this.dropdown.on("click",".suggestion",t=>this.selectItem(jQuery(t.currentTarget).index())))},Voxel.Maps.Autocomplete.prototype.querySuggestions=function(t){this.resetFocus(),this.showDropdown(),this.onChange(),Voxel.Maps.getGeocoder().geocode(t.target.value,{limit:5,_ac:this.options},function(t){if(this.hasQueried=!0,this.removeSuggestions(),!t)return!1;t.forEach(this.addSuggestion.bind(this))}.bind(this))},Voxel.Maps.Autocomplete.prototype.navigateDropdown=function(t){this.hasQueried||this.input.trigger("input"),this.showDropdown(),40===t.keyCode&&(this.focusedItem++,this.focusItem()),38===t.keyCode&&(this.focusedItem--,this.focusItem()),13===t.keyCode&&(t.preventDefault(),0!==this.focusedItem)&&this.selectItem(this.focusedItem-1)},Voxel.Maps.Autocomplete.prototype.focusItem=function(){this.dropdown.find(".suggestions-list .suggestion").removeClass("active");var t=this.dropdown.find(".suggestions-list .suggestion");this.focusedItem<0&&(this.focusedItem=t.length),this.focusedItem>t.length&&(this.focusedItem=0),0!==this.focusedItem&&this.dropdown.find(".suggestions-list .suggestion").eq(this.focusedItem-1).addClass("active")},Voxel.Maps.Autocomplete.prototype.resetFocus=function(t){this.focusedItem=0,this.dropdown.find(".suggestions-list .suggestion").removeClass("active")},Voxel.Maps.Autocomplete.prototype.showDropdown=function(t){this.dropdown.addClass("active");var e=this.input.get(0).getBoundingClientRect(),o=this.input.offset();this.dropdown.css({top:o.top+e.height+"px",left:o.left+"px",width:e.width+"px"})},Voxel.Maps.Autocomplete.prototype.hideDropdown=function(t){this.dropdown.removeClass("active")},Voxel.Maps.Autocomplete.prototype.selectItem=function(t){t=this.dropdown.find(".suggestions-list .suggestion").eq(t).data("place");this.input.val(t.address),this.resetFocus(),this.hideDropdown(),this.onChange(t)},Voxel.Maps.Autocomplete.prototype.attachDropdown=function(){this.dropdown=jQuery('<div class="ts-autocomplete-dropdown"><div class="suggestions-list"></div></div>'),this.input.addClass("ts-autocomplete-input").attr("autocomplete","off"),jQuery("body").append(this.dropdown)},Voxel.Maps.Autocomplete.prototype.removeSuggestions=function(){this.dropdown.find(".suggestions-list").html("")},Voxel.Maps.Autocomplete.prototype.addSuggestion=function(t){var e=jQuery(['<div class="suggestion">','<span class="suggestion--address"></span>',"</div>"].join(""));e.data("place",t),e.find(".suggestion--address").text(t.address),this.dropdown.find(".suggestions-list").append(e)},Voxel.Maps.Bounds.prototype.init=function(t,e){this.southwest=t,this.northeast=e,this.bounds=new mapboxgl.LngLatBounds(t?.getSourceObject(),e?.getSourceObject())},Voxel.Maps.Bounds.prototype.getSouthWest=function(){return this.southwest},Voxel.Maps.Bounds.prototype.getNorthEast=function(){return this.northeast},Voxel.Maps.Bounds.prototype.extend=function(t){this.bounds.extend(t.getSourceObject())},Voxel.Maps.Bounds.prototype.empty=function(){return this.bounds.isEmpty()},Voxel.Maps.Bounds.prototype.getSourceObject=function(){return this.bounds},Voxel.Maps.Geocoder.prototype.init=function(){},Voxel.Maps.Geocoder.prototype.geocode=function(t,o,e){var n=this,s=!1,a=("function"==typeof o&&(e=o,o={}),{access_token:Voxel_Config.mapbox?.api_key,limit:1,language:Voxel_Config.mapbox.language}),i=o._ac,o=(delete o._ac,i?.feature_types?.length&&(o.types=i.feature_types.join(",")),i?.countries?.length&&(o.country=i.countries.join(",")),jQuery.extend(!0,{},a,o));if(!encodeURIComponent(t).length)return e(s);jQuery.get({url:"https://api.mapbox.com/geocoding/v5/mapbox.places/{query}.json".replace("{query}",encodeURIComponent(t)),data:o,dataType:"json",success:function(t,e){"success"===e&&t&&t.features.length&&(s=1===o.limit?n.formatFeature(t.features[0]):t.features.map(n.formatFeature))},complete:function(){e(s)}})},Voxel.Maps.Geocoder.prototype.formatFeature=function(t){var e;return e=t.bbox?new Voxel.Maps.Bounds(new Voxel.Maps.LatLng(t.bbox[1],t.bbox[0]),new Voxel.Maps.LatLng(t.bbox[3],t.bbox[2])):(e=1/370,new Voxel.Maps.Bounds(new Voxel.Maps.LatLng(t.geometry.coordinates[1]-e,t.geometry.coordinates[0]-e),new Voxel.Maps.LatLng(t.geometry.coordinates[1]+e,t.geometry.coordinates[0]+e))),{address:t.place_name,latlng:new Voxel.Maps.LatLng(t.geometry.coordinates[1],t.geometry.coordinates[0]),viewport:e}},Voxel.Maps.LatLng.prototype.init=function(t,e){this.latlng=new mapboxgl.LngLat(e,t)},Voxel.Maps.LatLng.prototype.getLatitude=function(){return this.latlng.lat},Voxel.Maps.LatLng.prototype.getLongitude=function(){return this.latlng.lng},Voxel.Maps.LatLng.prototype.toGeocoderFormat=function(){return[this.getLongitude(),this.getLatitude()].join(",")},Voxel.Maps.LatLng.prototype.getSourceObject=function(){return this.latlng},Voxel.Maps.Map.prototype.init=function({el:t,zoom:e,center:o,minZoom:n,maxZoom:s}){this.eventMap={zoom_changed:"zoomstart",bounds_changed:"moveend"},this.map=new mapboxgl.Map({container:t,zoom:e,minZoom:2.3<=n?n:2.3,maxZoom:s<=24?s:24,interactive:!0,style:Voxel_Config.mapbox?.skin||"mapbox://styles/mapbox/streets-v12",scrollZoom:!0,projection:"mercator",dragRotate:!1}),this.map.addControl(new mapboxgl.NavigationControl({showCompass:!1})),this.map.addControl(new mapboxgl.FullscreenControl),this.addListenerOnce("style.load",()=>Voxel.Maps.MapboxSetLanguage(this)),this.setCenter(o)},Voxel.Maps.Map.prototype.setZoom=function(t){this.map.setZoom(t)},Voxel.Maps.Map.prototype.getZoom=function(){return this.map.getZoom()},Voxel.Maps.Map.prototype.getMinZoom=function(){return this.map.getMinZoom()},Voxel.Maps.Map.prototype.getMaxZoom=function(){return this.map.getMaxZoom()},Voxel.Maps.Map.prototype.setCenter=function(t){this.map.setCenter(t.getSourceObject())},Voxel.Maps.Map.prototype.getCenter=function(){return new Voxel.Maps.LatLng(this.map.getCenter().lat,this.map.getCenter().lng)},Voxel.Maps.Map.prototype.getBounds=function(){var t=this.map.getBounds(),e=t.getNorthEast(),t=t.getSouthWest();return new Voxel.Maps.Bounds(new Voxel.Maps.LatLng(t.lat,t.lng),new Voxel.Maps.LatLng(e.lat,e.lng))},Voxel.Maps.Map.prototype.fitBounds=function(t){t.getSourceObject().isEmpty()||this.map.fitBounds(t.getSourceObject(),{padding:15,animate:!1})},Voxel.Maps.Map.prototype.panTo=function(t){this.map.panTo(t.getSourceObject())},Voxel.Maps.Map.prototype.getClickPosition=function(t){return new Voxel.Maps.LatLng(t.lngLat.lat,t.lngLat.lng)},Voxel.Maps.Map.prototype.addListener=function(t,e){return this.map.on(this.mapEvent(t),function(t){e(t)}),{event:t,cb:e}},Voxel.Maps.Map.prototype.addListenerOnce=function(t,e){return this.map.once(this.mapEvent(t),function(t){e(t)}),{event:t,cb:e}},Voxel.Maps.Map.prototype.removeListener=function(t){this.map.off(t.event,t.cb)},Voxel.Maps.Map.prototype.trigger=function(t){this.map.fire(this.mapEvent(t))},Voxel.Maps.Map.prototype.getSourceObject=function(){return this.map},Voxel.Maps.Marker.prototype.init=function({map:t,position:e,onClick:o}){this.node=this.getTemplate().get(0),this.marker=new mapboxgl.Marker(this.node),this.node.addEventListener("click",t=>{o&&o(t,this)}),e&&this.setPosition(e),t&&this.setMap(t)},Voxel.Maps.Marker.prototype.getPosition=function(){return this.position},Voxel.Maps.Marker.prototype.setPosition=function(t){this.position=t,this.marker.setLngLat(t.getSourceObject())},Voxel.Maps.Marker.prototype.getMap=function(){return this.map},Voxel.Maps.Marker.prototype.setMap=function(t){this.map=t,this.marker.addTo(t.getSourceObject())},Voxel.Maps.Marker.prototype.remove=function(){return this.marker.remove(),this},Voxel.Maps.Marker.prototype.addClass=function(t){return this.node?.classList.add(t)},Voxel.Maps.Marker.prototype.removeClass=function(t){return this.node?.classList.remove(t)},Voxel.Maps.Marker.prototype.getSourceObject=function(){return this.marker},Voxel.Maps.Popup.prototype.init=function({map:t,position:e,content:o}){this.popup=new mapboxgl.Popup({closeButton:!1,maxWidth:"none",className:"ts-mapbox-popup ts-marker",anchor:"bottom",offset:0}),this.map=t,e&&this.setPosition(e),o&&this.setContent(o),t&&this.setMap(t)},Voxel.Maps.Popup.prototype.setContent=function(t){this.popup.setDOMContent(t),setTimeout(()=>this.fitToScreen(),0)},Voxel.Maps.Popup.prototype.setPosition=function(t){this.popup.setLngLat(t.getSourceObject())},Voxel.Maps.Popup.prototype.setMap=function(t){this.map=t},Voxel.Maps.Popup.prototype.remove=function(){this.popup.remove()},Voxel.Maps.Popup.prototype.show=function(){this.popup.addTo(this.map.getSourceObject())},Voxel.Maps.Popup.prototype.hide=function(){this.popup.remove()},Voxel.Maps.Popup.prototype.fitToScreen=function(){var t=this.popup.getElement().getBoundingClientRect();let e=t.height+10,o=t.width/2+10,n=30,s=t.width/2+10;var t=this.map.getSourceObject(),a=t.getCanvas().getBoundingClientRect(),i=t.project(t.getCenter());let p=i.x,r=i.y;var u=t.project(this.popup.getLngLat());a.width-u.x<o&&(i.x+=o-(a.width-u.x)),u.x<s&&(i.x-=s-u.x),u.y<e-1&&(i.y-=e-u.y),a.height-u.y<n-1&&(i.y+=n-(a.height-u.y)),i.x===p&&i.y===r||t.panTo(t.unproject(i),{duration:200})},Voxel.Maps.Circle.prototype.init=function({map:t=null,center:e=null,radius:o=null}){this.map=t,this.locationNode=jQuery('<div class="hidden"><div class="map-circle-center"></div></div>').get(0),this.locationMarker=new mapboxgl.Marker(this.locationNode),this.locationMarker.setLngLat(e.getSourceObject()),this.locationMarker.addTo(t.getSourceObject()),this.node=jQuery('<div class="hidden"><div class="map-circle"></div></div>').get(0),this.marker=new mapboxgl.Marker(this.node),this.marker.setLngLat(e.getSourceObject()),this.radius=o,this.marker.addTo(t.getSourceObject()),this._draw(),t.addListener("zoom",()=>this._draw()),t.addListener("pitch",()=>this._draw())},Voxel.Maps.Circle.prototype.hide=function(){this.node.classList.add("hidden"),this.locationNode.classList.add("hidden")},Voxel.Maps.Circle.prototype.show=function(){this.node.classList.remove("hidden"),this.locationNode.classList.remove("hidden")},Voxel.Maps.Circle.prototype.setCenter=function(t){this.marker.setLngLat(t.getSourceObject()),this.locationMarker.setLngLat(t.getSourceObject()),this._draw()},Voxel.Maps.Circle.prototype.setRadius=function(t){this.radius=t,this._draw()},Voxel.Maps.Circle.prototype.getBounds=function(){return new Voxel.Maps.Bounds(new Voxel.Maps.LatLng(this.bounds.getSouth(),this.bounds.getWest()),new Voxel.Maps.LatLng(this.bounds.getNorth(),this.bounds.getEast()))},Voxel.Maps.Circle.prototype._updateBounds=function(){var t=this.marker.getLngLat(),e={north:null,east:null,south:null,west:null},o=(e.east=e.west=this.radius/t.distanceTo(new mapboxgl.LngLat(t.lng+1,t.lat)),e.north=this.radius/t.distanceTo(new mapboxgl.LngLat(t.lng,t.lat+1)),e.south=this.radius/t.distanceTo(new mapboxgl.LngLat(t.lng,t.lat-1)),(t,e,o)=>Math.max(e,Math.min(t,o)));this.bounds=new mapboxgl.LngLatBounds([o(t.lng-e.west,-180,180),o(t.lat-e.south,-90,90)],[o(t.lng+e.east,-180,180),o(t.lat+e.north,-90,90)])},Voxel.Maps.Circle.prototype._draw=function(){this._updateBounds();var t=this.map.getSourceObject(),e=t.project(this.bounds.getSouthWest()),t=t.project(this.bounds.getNorthEast()),o=this.node.querySelector(".map-circle");o.style.left=e.x+"px",o.style.top=t.y+"px",o.style.width=t.x-e.x+"px",o.style.height=e.y-t.y+"px"},jQuery(t=>{mapboxgl.accessToken=Voxel_Config.mapbox?.api_key;let e=new a,o=Voxel_Config.mapbox.language;if(!(o&&-1<e.supportedLanguages.indexOf(o))){var n=navigator.languages?navigator.languages[0]:navigator.language||navigator.userLanguage,s=n&&n.split("-");let t=n;1<s.length&&(t=s[0]),o=-1<e.supportedLanguages.indexOf(t)?t:"en"}"ar"===o&&mapboxgl.setRTLTextPlugin("https://api.mapbox.com/mapbox-gl-js/plugins/mapbox-gl-rtl-text/v0.2.3/mapbox-gl-rtl-text.js",null,!0),Voxel_Config.mapbox.language=o,Voxel.Maps.MapboxSetLanguage=t=>{t=t.getSourceObject();t.setStyle(e.setLanguage(t.getStyle(),o))},Voxel.Maps.Loaded=!0,document.dispatchEvent(new Event("maps:loaded")),jQuery(".ts-map.ts-map-autoload").each((t,e)=>{var o=jQuery(e).data("config"),e={el:e,zoom:3};o&&(o.zoom&&(e.zoom=o.zoom),o.minZoom&&(e.minZoom=o.minZoom),o.maxZoom&&(e.maxZoom=o.maxZoom),o.center)&&(e.center=new Voxel.Maps.LatLng(o.center.lat,o.center.lng));let n=new Voxel.Maps.Map(e);o.markers&&o.markers.forEach(t=>{new Voxel.Maps.Marker({map:n,position:new Voxel.Maps.LatLng(t.lat,t.lng),template:t.template})})})})});
