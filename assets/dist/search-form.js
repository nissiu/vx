!function(e){"function"==typeof define&&define.amd?define("searchForm",e):e()}(function(){"use strict";var s={template:"#search-form-post-types-filter",data(){return{selected:null,search:""}},created(){this.selected=this.$root.post_type.key},methods:{select(e){this.selected=e,this.$root.setPostType(e),this.search=""},onSave(){this.$root.setPostType(this.selected),this.search="",this.$refs.formGroup.blur()},onBlur(){this.search=""}},computed:{postTypes(){return this.search.trim().length?Object.values(this.$root.post_types).filter(e=>-1!==e.label.toLowerCase().indexOf(this.search.trim().toLowerCase())):Object.values(this.$root.post_types)}}},i={template:"#search-form-keywords-filter",props:{filter:Object,repeaterId:String},data(){return{value:this.filter.value||""}},methods:{isFilled(){return this.value.trim().length},saveValue(){this.filter.value=this.isFilled()?this.value.trim():null},onPopupSave(){this.saveValue(),this.$refs.formGroup?.blur()},onPopupClear(){this.value="",this.$refs.input.focus()},onReset(){this.value=""}}},a={template:"#search-form-stepper-filter",props:{filter:Object,repeaterId:String},data(){return{value:this.filter.props.value}},created(){this.debouncedSave=Voxel.helpers.debounce(()=>this.saveValue(),300)},methods:{increment(){"number"!=typeof this.value?this.setValue(this.filter.props.range_start):this.setValue(this.value+this.filter.props.step_size)},decrement(){"number"!=typeof this.value?this.setValue(this.filter.props.range_start):this.setValue(this.value-this.filter.props.step_size)},setValue(e){""===e||"number"!=typeof e?this.value="":e<this.filter.props.range_start?this.value=this.filter.props.range_start:e>this.filter.props.range_end?this.value=this.filter.props.range_end:this.value=Number(e.toFixed(this.filter.props.precision))},saveValue(){this.setValue(this.value),this.filter.value=this.isFilled()?this.value:null},onSave(){this.saveValue(),this.$refs.formGroup.blur()},onClear(){this.value="",this.$refs.input.focus()},isFilled(){return"number"==typeof this.value},onReset(){this.value=""}}},r={template:"#search-form-range-filter",props:{filter:Object,repeaterId:String},data(){return{value:this.filter.props.value,displayValue:this.formatForDisplay(this.filter.props.value),default:[],slider:null}},created(){"inline"===this.filter.props.display_as&&this.setupInlineSlider()},unmounted(){this.slider?.destroy()},methods:{setupSlider(){var e,t,s,i,a;this.slider||(s="single"===(e=this.filter.props).handles?(t="in_range"===e.compare?[1,0]:[0,1],this.default="in_range"===e.compare?e.range_end:e.range_start):(t="in_range"===e.compare?[0,1,0]:[1,0,1],this.default="in_range"===e.compare?[e.range_start,e.range_end]:[e.range_start,e.range_start]),this.value.length&&(s=this.value),i="ltr","rtl"===document.documentElement.getAttribute("dir")&&(i="rtl"),(a=document.createElement("div")).classList.add("range-slider"),this.slider=noUiSlider.create(a,{start:s,connect:t,step:e.step_size,range:{min:this.filter.props.range_start,max:this.filter.props.range_end},direction:i}),this.slider.on("update",e=>{this.value=e.map(e=>Number(e))}))},onEntry(){this.setupSlider(),this.$nextTick(()=>this.$refs.sliderWrapper.append(this.slider.target))},setupInlineSlider(){this.setupSlider(),this.$nextTick(()=>this.$refs.sliderWrapper.append(this.slider.target)),this.slider.on("update",Voxel.helpers.debounce(()=>this.saveValue(),200))},saveValue(){this.filter.value=this.isFilled()?this.value.join(".."):null,this.displayValue=this.value.map(e=>e.toLocaleString()).join(" — ")},onSave(){this.saveValue(),this.$refs.formGroup.blur()},onClear(){this.slider.set(this.default)},isFilled(){var e=Array.isArray(this.default)?this.default:[this.default];return this.value.length&&this.value.join("..")!==e.join("..")},formatForDisplay(e){let t=this.filter.props.format;return e.map(e=>(t.numeric&&(e=e.toLocaleString()),t.prefix+e+t.suffix)).join(" — ")},onReset(){this.slider?.set(this.default)}},computed:{popupDisplayValue(){return this.formatForDisplay(this.value)}}},l={template:"#search-form-location-filter",props:{filter:Object,repeaterId:String},data(){return{addressInput:null,value:this.filter.props.value,displayValue:this.filter.props.value.address,displayDistance:null,loading:!1,visibleAreaLabel:this.filter.props.l10n.visibleArea,slider:null,units:this.filter.props.radius.units}},created(){jQuery(this.$root.$options.el).on("map:bounds_updated",(e,t)=>this.useBounds(t)),this.filter.props.value.radius&&(this.displayDistance=this.filter.props.value.radius+("mi"===this.units?"mi":"km")),this.value.radius||(this.value.radius=this.filter.props.radius.default),null!==this.value.address&&Voxel.Maps.await(()=>{this.updateMap(),jQuery(this.$root.$options.el).off("toggled-view:map",this.updateMap),jQuery(this.$root.$options.el).one("toggled-view:map",this.updateMap)}),"inline"===this.filter.props.display_as&&this.setupInlineAddress(),"inline"===this.filter.props.display_proximity_as&&this.setupInlineProximity()},unmounted(){this.slider?.destroy()},methods:{onOpen(){Voxel.Maps.await(()=>{this.addressInput||(this.addressInput=document.createElement("input"),this.addressInput.setAttribute("type","text"),this.addressInput.setAttribute("placeholder",this.filter.props.placeholder),this.autocomplete=new Voxel.Maps.Autocomplete(this.addressInput,e=>{e?this.usePlaceData(e):(this.value.address=null,this.value.swlat=null,this.value.swlng=null,this.value.nelat=null,this.value.nelng=null,this.value.lat=null,this.value.lng=null)},this.$root.config.autocomplete)),this.addressInput.value=this.value.address,this.$nextTick(()=>{this.$refs.addressWrapper.appendChild(this.addressInput),this.addressInput.value&&this.addressInput.value!==this.visibleAreaLabel||(this.addressInput.value="",requestAnimationFrame(()=>this.addressInput.focus()))})})},setupInlineAddress(){Voxel.Maps.await(()=>{this.addressInput||(this.addressInput=document.createElement("input"),this.addressInput.setAttribute("type","text"),this.addressInput.setAttribute("placeholder",this.filter.props.placeholder),this.addressInput.classList.add("inline-input"),this.autocomplete=new Voxel.Maps.Autocomplete(this.addressInput,e=>{e?(this.usePlaceData(e),this.saveValue()):(this.value.address=null,this.value.swlat=null,this.value.swlng=null,this.value.nelat=null,this.value.nelng=null,this.value.lat=null,this.value.lng=null,this.addressInput.value||this.saveValue())},this.$root.config.autocomplete)),this.addressInput.value=this.value.address,this.$nextTick(()=>{this.$refs.addressWrapper.appendChild(this.addressInput),this.addressInput.value&&this.addressInput.value!==this.visibleAreaLabel||(this.addressInput.value="")})})},onOpenProximity(){this.value.method="radius",this.setupSlider(),this.$nextTick(()=>this.$refs.sliderWrapper.append(this.slider.target))},setupInlineProximity(){this.setupSlider(),this.$nextTick(()=>this.$refs.sliderWrapper.append(this.slider.target)),this.slider.on("update",Voxel.helpers.debounce(()=>this.saveValue(),200))},onClearProximity(){this.value.method="area"},setupSlider(){if(!this.slider){this.filter.props;let e=this.filter.props.radius.default;this.value.radius&&(e=this.value.radius);var t=document.createElement("div");t.classList.add("range-slider"),this.slider=noUiSlider.create(t,{start:e,connect:[1,0],step:this.filter.props.radius.step,range:{min:this.filter.props.radius.min,max:this.filter.props.radius.max}}),this.slider.on("update",e=>this.value.radius=Number(e[0]))}},usePlaceData(e){var t=e.viewport.getSouthWest(),s=e.viewport.getNorthEast();this.value.address=e.address,this.value.swlat=this.$root._shortenPoint(t.getLatitude()),this.value.swlng=this.$root._shortenPoint(t.getLongitude()),this.value.nelat=this.$root._shortenPoint(s.getLatitude()),this.value.nelng=this.$root._shortenPoint(s.getLongitude()),this.value.lat=this.$root._shortenPoint(e.latlng.getLatitude()),this.value.lng=this.$root._shortenPoint(e.latlng.getLongitude()),this.addressInput&&(this.addressInput.value=e.address)},useBounds(e){var t=e.getSouthWest(),e=e.getNorthEast(),s=this.visibleAreaLabel,i=this.$root._shortenPoint(t.getLatitude()),t=this.$root._shortenPoint(t.getLongitude()),a=this.$root._shortenPoint(e.getLatitude()),e=this.$root._shortenPoint(e.getLongitude());this.value.method="area",this.value.address=s,this.value.swlat=i,this.value.swlng=t,this.value.nelat=a,this.value.nelng=e,this.filter.value=s+`;${i},${t}..${a},`+e,this.displayValue=s,this.displayDistance=null,this.addressInput&&(this.addressInput.value=s)},updateMap(){this.$root.map&&("radius"===this.value.method?this.isFilled()?(this.$root.mapCircle.setCenter(new Voxel.Maps.LatLng(this.value.lat,this.value.lng)),this.$root.mapCircle.setRadius(this.value.radius*("mi"===this.units?1.609344:1)*1e3),this.$root.silentMapUpdate(()=>{this.$root.map.fitBounds(this.$root.mapCircle.getBounds()),this.showOnIdleHandler=this.$root.map.addListenerOnce("idle",()=>this.$root.mapCircle.show()),this.$root.mapCircle.show()})):this.$root.mapCircle.hide():(this.$root.mapCircle.hide(),this.showOnIdleHandler&&this.$root.map.removeListener(this.showOnIdleHandler),this.isFilled()&&this.$root.silentMapUpdate(()=>{this.$root.map.fitBounds(new Voxel.Maps.Bounds(new Voxel.Maps.LatLng(this.value.swlat,this.value.swlng),new Voxel.Maps.LatLng(this.value.nelat,this.value.nelng)))})))},saveValue(){var e,t,s,i,a,r,l,n,o;this.isFilled()?({method:e,address:t,swlat:s,swlng:i,nelat:a,nelng:r,lat:l,lng:n,radius:o}=this.value,"radius"===e?(this.filter.value=t+`;${l},${n},`+o,this.displayDistance=o+("mi"===this.units?"mi":"km")):(this.filter.value=t+`;${s},${i}..${a},`+r,this.displayDistance=null)):(this.filter.value=null,this.displayDistance=null),this.updateMap(),jQuery(this.$root.$options.el).off("toggled-view:map",this.updateMap),jQuery(this.$root.$options.el).one("toggled-view:map",this.updateMap),this.displayValue=this.value.address},onSave(){this.saveValue(),this.$refs.formGroup?.$refs.popup?.$emit("blur"),this.$refs.proximity?.$refs.popup?.$emit("blur")},onClear(){this.addressInput.value="",this.addressInput.dispatchEvent(new Event("input")),this.addressInput.focus()},geolocate(t,e){this.loading=!0,Voxel.Maps.await(()=>{Voxel.Maps.getGeocoder().getUserLocation({fetchAddress:!0,receivedAddress:e=>{this.usePlaceData(e),this.value.method="radius",this.loading=!1,"function"==typeof t&&t(e)},addressFail:()=>{Voxel.alert(Voxel_Config.l10n.addressFail,"error"),this.addressInput?.focus(),this.loading=!1,"function"==typeof e&&e()},positionFail:()=>{Voxel.alert(Voxel_Config.l10n.positionFail,"error"),this.addressInput?.focus(),this.loading=!1,"function"==typeof e&&e()}})})},useMyLocation(){this.geolocate(()=>this.onSave())},isFilled(){return!("string"!=typeof this.value.address||!this.value.address.trim()||("radius"===this.value.method?[this.value.lat,this.value.lng,this.value.radius]:[this.value.swlat,this.value.swlng,this.value.nelat,this.value.nelng]).includes(null))},ensureLocation(){this.value.address&&this.value.address!==this.visibleAreaLabel?(this.loading=!0,Voxel.Maps.getGeocoder().geocode(this.value.address,e=>{e?this.usePlaceData(e):this.addressInput?.focus(),this.loading=!1,"inline"===this.filter.props.display_proximity_as&&this.saveValue()})):(this.value.address="",this.addressInput&&(this.addressInput.value=""),"inline"!==this.filter.props.display_proximity_as&&this.addressInput?.focus(),"inline"===this.filter.props.display_proximity_as&&this.saveValue())},onReset(){this.value.address=null,this.value.swlat=null,this.value.swlng=null,this.value.nelat=null,this.value.nelng=null,this.value.lat=null,this.value.lng=null,this.value.method="area",this.addressInput&&(this.addressInput.value="")}},watch:{"value.method"(){"radius"===this.value.method?this.value.lat&&this.value.lng&&this.value.address!==this.visibleAreaLabel?"inline"===this.filter.props.display_proximity_as&&this.saveValue():this.ensureLocation():this.value.swlat&&this.value.swlng&&this.value.nelat&&this.value.nelng?"inline"===this.filter.props.display_proximity_as&&this.saveValue():this.ensureLocation()}}},n={template:"#search-form-availability-filter",components:{datePicker:{template:"#availability-date-picker",props:{filter:Object,parent:Object},data(){return{picker:null,value:this.filter.props.value,today:new Date}},mounted(){this.picker=new Pikaday({field:this.$refs.input,container:this.$refs.calendar,bound:!1,firstDay:1,keyboardInput:!1,defaultDate:this.value.start,minDate:this.today,onSelect:e=>{this.value.start=e,this.parent.onSave()},selectDayFn:e=>this.value.start&&this.value.start.toDateString()===e.toDateString()})},unmounted(){setTimeout(()=>this.picker.destroy(),200)},methods:{refresh(){this.picker.draw()},reset(){this.value.start=null,this.refresh()}},computed:{startLabel(){return this.value.start?Voxel.helpers.dateFormat(this.value.start):this.filter.props.l10n.checkIn}}},rangePicker:{template:"#availability-date-range-picker",props:{filter:Object,parent:Object},data(){return{picker:null,activePicker:"start",value:this.filter.props.value,today:new Date}},mounted(){this.picker=new Pikaday({field:this.$refs.input,container:this.$refs.calendar,bound:!1,firstDay:1,keyboardInput:!1,numberOfMonths:2,defaultDate:this.value.start,minDate:this.today,theme:"pika-range",onSelect:e=>{"start"===this.activePicker?(this.setStartDate(e),this.activePicker="end"):(this.setEndDate(e),this.activePicker="start",this.parent.onSave()),this.refresh()},selectDayFn:e=>!(!this.value.start||e.toDateString()!==this.value.start.toDateString())||!(!this.value.end||e.toDateString()!==this.value.end.toDateString())||void 0,disableDayFn:e=>{if("end"===this.activePicker&&this.value.start&&e<this.value.start)return!0}}),this.setStartDate(this.value.start),this.setEndDate(this.value.end),this.refresh()},unmounted(){setTimeout(()=>this.picker.destroy(),200)},methods:{setStartDate(e){this.value.start=e,this.picker.setStartRange(e),this.value.end&&this.value.start>this.value.end&&this.setEndDate(null)},setEndDate(e){this.value.end=e,this.picker.setEndRange(e)},refresh(){this.picker.draw()},reset(){this.setStartDate(null),this.setEndDate(null),this.refresh(),this.activePicker="start"}},computed:{startLabel(){return this.value.start?Voxel.helpers.dateFormat(this.value.start):this.filter.props.l10n.checkIn},endLabel(){return this.value.end?Voxel.helpers.dateFormat(this.value.end):this.filter.props.l10n.checkOut}},watch:{activePicker(){this.refresh()}}}},props:{filter:Object,repeaterId:String},data(){return{value:this.filter.props.value,displayValue:this.filter.props.displayValue}},created(){"string"==typeof this.value.start&&(this.value.start=new Date(this.value.start+" 00:00:00")),"string"==typeof this.value.end&&(this.value.end=new Date(this.value.end+" 00:00:00"))},methods:{selectPreset(e){this.filter.value=e},isUsingCustomRange(){return null!==this.filter.value&&this.filter.value.includes("..")},saveValue(){var e,t;this.value.end||(this.value.end=this.value.start),this.isFilled()?(e=Voxel.helpers.dateFormatYmd(this.value.start),t=Voxel.helpers.dateFormatYmd(this.value.end),this.filter.value="single-date"===this.filter.props.inputMode?e:e+".."+t):this.filter.value=null,this.displayValue.start=this.$refs.picker.startLabel,this.displayValue.end=this.$refs.picker.endLabel},onSave(){this.saveValue(),this.$refs.formGroup.blur()},onClear(){this.$refs.picker.reset()},isFilled(){return this.value.start&&this.value.end},openRangePicker(e){"end"!==e||this.value.end||(e="start"),this.$root.activePopup=this.filter.id,this.$nextTick(()=>this.$refs.picker.activePicker=e)},onReset(){this.value.start=null,this.value.end=null}}},o={template:"#search-form-open-now-filter",props:{filter:Object,repeaterId:String},data(){return{value:this.filter.value||!1}},methods:{toggle(){this.filter.value=null===this.filter.value?1:null},saveValue(){this.filter.value=this.value?1:null},onSave(){this.saveValue(),this.$refs.formGroup.blur()},onReset(){this.value=!1}}};const h={template:"#search-form-terms-filter-list",props:["terms","parent-term","previous-list","list-key"],data(){return{termsFilter:Voxel.helpers.getParent(this,"terms-filter"),perPage:50,page:1}},methods:{selectTerm(e){e.children&&e.children.length?(this.termsFilter.slide_from="right",this.termsFilter.active_list="terms_"+e.id):this.termsFilter.selectTerm(e)},goBack(){this.termsFilter.slide_from="left",this.termsFilter.active_list=this.previousList},beforeEnter(e,t){setTimeout(()=>e.closest(".min-scroll").scrollTop=this.termsFilter.scrollPosition[t]||0,100)},beforeLeave(e,t){this.termsFilter.scrollPosition[t]=e.closest(".min-scroll").scrollTop}},computed:{termsWithChildren(){return this.terms.filter(e=>e.children&&e.children.length)}}};var d={template:"#search-form-terms-filter",name:"terms-filter",props:{filter:Object,repeaterId:String},data(){return{value:this.filter.props.selected||{},terms:this.filter.props.terms,active_list:"toplevel",slide_from:"right",search:"",firstLabel:"",remainingCount:0,scrollPosition:{}}},created(){this.firstLabel=this._getFirstLabel(),this.remainingCount=this._getRemainingCount();let s=(t,e)=>{t.parentRef=e,t.children&&t.children.forEach(e=>s(e,t)),this.value[t.slug]&&(this.value[t.slug]=t)};this.terms.forEach(e=>s(e,null)),Object.keys(this.value).forEach(e=>{let t=this.value[e].parentRef;for(;t;)t.hasSelection=!0,t=t.parentRef})},methods:{saveValue(){this.filter.value=this.isFilled()?Object.keys(this.value).join(","):null,this.firstLabel=this._getFirstLabel(),this.remainingCount=this._getRemainingCount()},onSave(){this.saveValue(),this.$refs.formGroup?.blur()},onClear(){Object.keys(this.value).forEach(e=>{let t=this.value[e].parentRef;for(;t;)t.hasSelection=!1,t=t.parentRef}),this.value={},this.search="",this.$refs.searchInput?.focus()},isFilled(){return Object.keys(this.value).length},_getFirstLabel(){return Object.values(this.value)[0]?.label},_getRemainingCount(){return Object.values(this.value).length-1},selectTerm(a){if(this.value[a.slug]){delete this.value[a.slug];let e=a.parentRef;for(;e;)e.children.some(e=>e.hasSelection||this.value[e.slug])||(e.hasSelection=!1),e=e.parentRef}else{this.filter.props.multiple||Object.keys(this.value).forEach(e=>delete this.value[e]);let e=(this.value[a.slug]=a).parentRef;for(;e;)delete this.value[e.slug],e.hasSelection=!0,e=e.parentRef;Object.values(this.value).forEach(e=>{let t=e.parentRef;var s=[];let i=!1;for(;t;){if(t.slug===a.slug){i=!0;break}s.push(t),t=t.parentRef}i&&(delete this.value[e.slug],s.forEach(e=>e.hasSelection=!1))}),this.filter.props.multiple||"inline"===this.filter.props.display_as||this.onSave()}"inline"===this.filter.props.display_as&&this.saveValue()},onReset(){this.search="",Object.keys(this.value).forEach(e=>{let t=this.value[e].parentRef;for(;t;)t.hasSelection=!1,t=t.parentRef;delete this.value[e]})}},computed:{searchResults(){var t,s;return!!this.search.trim().length&&(t=[],s=e=>{-1!==e.label.toLowerCase().indexOf(this.search.trim().toLowerCase())&&t.push(e),e.children&&e.children.forEach(s)},this.terms.forEach(s),t)}}},p={template:"#search-form-order-by-filter",inheritAttrs:!1,props:{filter:Object,repeaterId:String},data(){return{value:this.filter.value||"",loading:!1}},mounted(){this.$nextTick(()=>{this.selected?.requires_location&&!this.selected.has_location&&("buttons"===this.filter.props.display_as?this.selectDropdownChoice(this.selected):this.selectChoice(this.selected));let e=this.$root.getLocationFilter();e&&this.$root.$watch(()=>e.value.lat,()=>{"radius"===e.value.method&&e.value.lat&&e.value.lng&&this.selected?.requires_location&&(this.filter.value=`${this.selected.key}(${e.value.lat},${e.value.lng})`)},{deep:!0})})},methods:{saveValue(){this.filter.value=this.isFilled()?this.value.trim():null},onSave(){this.saveValue(),this.$refs.formGroup.blur()},onClear(){this.value=""},isFilled(){return this.value.trim().length},selectDropdownChoice(s){s.requires_location?(this.loading=s.key,this.getNearbyLocation((e,t)=>{this.value=s.key+`(${e},${t})`,this.filter.value=this.value,this.$refs.formGroup?.blur()})):(this.value=s.key,this.$refs.formGroup?.blur())},selectChoice(s){s.requires_location?(this.loading=s.key,this.getNearbyLocation((e,t)=>{this.filter.value=s.key+`(${e},${t})`})):this.filter.value=s.key},sortKey(e){return"string"!=typeof e?null:e.split("(")[0]},getNearbyLocation(s){let i=this.$root.getLocationFilter();if(i){let t=()=>{i.geolocate(e=>{s(e.latlng.getLatitude(),e.latlng.getLongitude()),i.onSave(),this.loading=!1},()=>this.loading=!1)};i.isFilled()&&i.value.address!==i.visibleAreaLabel?"radius"===i.value.method?(s(i.value.lat,i.value.lng),i.onSave(),this.loading=!1):null!==i.value.lat&&null!==i.value.lng&&null!==i.value.radius?(i.value.method="radius",s(i.value.lat,i.value.lng),i.onSave(),this.loading=!1):(i.value.method="radius",Voxel.Maps.getGeocoder().geocode(i.value.address,e=>{e?(i.usePlaceData(e),s(i.value.lat,i.value.lng),i.onSave(),this.loading=!1):t()})):t()}else navigator.geolocation.getCurrentPosition(e=>{var t=this.$root._shortenPoint(e.coords.latitude),e=this.$root._shortenPoint(e.coords.longitude);s(t,e),this.loading=!1},()=>{Voxel.alert(Voxel_Config.l10n.positionFail,"error"),this.loading=!1})},onReset(){this.value=""}},computed:{displayValue(){return this.selected?.label},selected(){return this.filter.props.choices[this.sortKey(this.filter.value)]}}},u={template:"#search-form-recurring-date-filter",components:{datePicker:{template:"#recurring-date-picker",props:{filter:Object,parent:Object},data(){return{picker:null,value:this.filter.props.value}},mounted(){this.picker=new Pikaday({field:this.$refs.input,container:this.$refs.calendar,bound:!1,firstDay:1,keyboardInput:!1,defaultDate:this.value.start,onSelect:e=>{this.value.start=e,this.parent.onSave()},selectDayFn:e=>this.value.start&&this.value.start.toDateString()===e.toDateString()})},unmounted(){setTimeout(()=>this.picker.destroy(),200)},methods:{refresh(){this.picker.draw()},reset(){this.value.start=null,this.refresh()}},computed:{startLabel(){return this.value.start?Voxel.helpers.dateFormat(this.value.start):this.filter.props.l10n.pickDate}}},rangePicker:{template:"#recurring-date-range-picker",props:{filter:Object,parent:Object},data(){return{picker:null,activePicker:"start",value:this.filter.props.value}},mounted(){this.picker=new Pikaday({field:this.$refs.input,container:this.$refs.calendar,bound:!1,firstDay:1,keyboardInput:!1,numberOfMonths:2,defaultDate:this.value.start,theme:"pika-range",onSelect:e=>{"start"===this.activePicker?(this.setStartDate(e),this.activePicker="end"):(this.setEndDate(e),this.activePicker="start",this.parent.onSave()),this.refresh()},selectDayFn:e=>!(!this.value.start||e.toDateString()!==this.value.start.toDateString())||!(!this.value.end||e.toDateString()!==this.value.end.toDateString())||void 0,disableDayFn:e=>{if("end"===this.activePicker&&this.value.start&&e<this.value.start)return!0}}),this.setStartDate(this.value.start),this.setEndDate(this.value.end),this.refresh()},unmounted(){setTimeout(()=>this.picker.destroy(),200)},methods:{setStartDate(e){this.value.start=e,this.picker.setStartRange(e),this.value.end&&this.value.start>this.value.end&&this.setEndDate(null)},setEndDate(e){this.value.end=e,this.picker.setEndRange(e)},refresh(){this.picker.draw()},reset(){this.setStartDate(null),this.setEndDate(null),this.refresh(),this.activePicker="start"}},computed:{startLabel(){return this.value.start?Voxel.helpers.dateFormat(this.value.start):this.filter.props.l10n.from},endLabel(){return this.value.end?Voxel.helpers.dateFormat(this.value.end):this.filter.props.l10n.to}},watch:{activePicker(){this.refresh()}}}},props:{filter:Object,repeaterId:String},data(){return{value:this.filter.props.value,displayValue:this.filter.props.displayValue}},created(){"string"==typeof this.value.start&&(this.value.start=new Date(this.value.start+" 00:00:00")),"string"==typeof this.value.end&&(this.value.end=new Date(this.value.end+" 00:00:00"))},methods:{selectPreset(e){this.filter.value=e},isUsingCustomRange(){return null!==this.filter.value&&this.filter.value.includes("..")},saveValue(){var e,t;this.value.end||(this.value.end=this.value.start),this.isFilled()?(e=Voxel.helpers.dateFormatYmd(this.value.start),t=Voxel.helpers.dateFormatYmd(this.value.end),this.filter.value="single-date"===this.filter.props.inputMode?e:e+".."+t):this.filter.value=null,this.displayValue.start=this.$refs.picker.startLabel,this.displayValue.end=this.$refs.picker.endLabel},onSave(){this.saveValue(),this.$refs.formGroup.blur()},onClear(){this.$refs.picker.reset()},isFilled(){return this.value.start&&this.value.end},openRangePicker(e){"end"!==e||this.value.end||(e="start"),this.$root.activePopup=this.filter.id,this.$nextTick(()=>this.$refs.picker.activePicker=e)},onReset(){this.value.start=null,this.value.end=null}}},c={template:"#search-form-switcher-filter",props:{filter:Object,repeaterId:String},data(){return{value:this.filter.value||!1}},methods:{toggle(){this.filter.value=null===this.filter.value?1:null},saveValue(){this.filter.value=this.value?1:null},onSave(){this.saveValue(),this.$refs.formGroup.blur()},onReset(){this.value=!1}}},v={template:"#search-form-user-filter",props:{filter:Object,repeaterId:String}},f={template:"#search-form-relations-filter",props:{filter:Object,repeaterId:String}},m={template:"#search-form-post-status-filter",inheritAttrs:!1,props:{filter:Object,repeaterId:String},data(){return{value:this.filter.value||""}},methods:{saveValue(){this.filter.value=this.isFilled()?this.value.trim():null},onSave(){this.saveValue(),this.$refs.formGroup.blur()},onClear(){this.value=""},isFilled(){return this.value.trim().length},onReset(){this.value=""}},computed:{displayValue(){return this.selected?.label},selected(){return this.filter.props.choices[this.filter.value]}}},g={template:"#search-form-ui-heading-filter",props:{filter:Object,repeaterId:String}};window.render_search_form=()=>{Array.from(document.querySelectorAll(".ts-search-widget")).forEach(e=>{var t;e.__vue_app__||e.classList.contains("no-render")||((t=(e=>{let t=JSON.parse(e.closest(".elementor-widget-container").querySelector(".vxconfig").innerHTML);return Vue.createApp({el:e,mixins:[Voxel.mixins.base],data(){return{config:{showLabels:!0,defaultType:null,onSubmit:{},searchOn:null},loading:!1,resetting:!1,page:parseInt(Voxel.getSearchParam("pg")||1,10),post_types:{},post_type:null,activePopup:null,map:null,markers:[],_postFeedWidget:null,_mapWidget:null,popup:null,suspendDragSearch:!1,mapConfig:{},portal:{enabled:{desktop:t.general.portal.desktop,tablet:t.general.portal.tablet,mobile:t.general.portal.mobile},active:!1},breakpoint:null}},created(){this.setActiveBreakpoint(),this.config=jQuery.extend(!0,this.config,t.general),this.post_types=t.postTypes;var e=Object.keys(this.post_types);this.config.defaultType?this.setPostType(this.config.defaultType):e.length?this.setPostType(e[0]):this.post_type={key:"",label:"",icon:""},this.updateMap(),this.handlePagination(),this.$nextTick(this.handleNavbars),"filter_update"===this.config.searchOn&&this.$watch("currentValues",()=>{this.portal.enabled[this.breakpoint]&&this.portal.active||(this.page=1,this.getPosts())}),this.previousQueryString=this.currentQueryString},mounted(){requestAnimationFrame(()=>{document.addEventListener("mousedown",this._blur_portal)})},unmounted(){document.removeEventListener("mousedown",this._blur_portal)},methods:{setPostType(e){this.post_types[e]&&(this.post_type=this.post_types[e])},submit(){if("submit-to-archive"===this.config.onSubmit.action){var t=jQuery.param(this.currentValues).replace(/%2C/g,",").replace(/%3B/g,";").replace(/%20/g,"+");let e=this.post_type.archive;t.length&&(e+="?"+t),window.location.href=e}else{var e;"submit-to-page"===this.config.onSubmit.action?(t=this.currentQueryString,e=this.config.onSubmit.pageLink||"",window.location.href=e+"?"+t):(this.page=1,this.getPosts())}},getPosts(){var i,t,e,s;this.previousQueryString===this.currentQueryString?(this.loading=!1,this.resetting=!1):(this.loading=!0,i=this.getPostFeedWidget(),t=this.getMapWidget(),e=this.currentQueryString,s=Voxel_Config.ajax_url+"&action=search_posts&"+e,i?.addClass("vx-loading"),t?.addClass("vx-loading"),i&&(s+="&limit="+(parseInt(i.data("per-page"),10)||10),this.post_type.template_id&&(s+="&__template_id="+this.post_type.template_id),this.config.show_total_count&&(s+="&__get_total_count=1"),i.find('link[rel="stylesheet"]').each((e,t)=>{t.id&&!document.querySelector("#vx-assets-cache #"+CSS.escape(t.id))&&jQuery(t).clone().appendTo("#vx-assets-cache")})),jQuery.get(s,e=>{if(this.loading=!1,this.resetting=!1,this.previousQueryString=this.currentQueryString,t?.removeClass("vx-loading"),i){let s=jQuery(e);s.find('link[rel="stylesheet"]').each((e,t)=>{t.id&&!document.querySelector("#vx-assets-cache #"+CSS.escape(t.id))&&jQuery(t).appendTo("#vx-assets-cache")}),setTimeout(()=>{var e,t;"prev_next"===i.data("paginate")?(i.find(".post-feed-grid:first").html(s),(e=i.find("script.info")).data("has-prev")?i.find(".feed-pagination .ts-load-prev").removeClass("disabled"):i.find(".feed-pagination .ts-load-prev").addClass("disabled"),e.data("has-next")?i.find(".feed-pagination .ts-load-next").removeClass("disabled"):i.find(".feed-pagination .ts-load-next").addClass("disabled"),e.remove(),e.data("has-prev")||e.data("has-next")?i.find(".feed-pagination").removeClass("hidden"):i.find(".feed-pagination").addClass("hidden"),i.find(".ts-no-posts")[e.data("has-results")?"addClass":"removeClass"]("hidden"),this.config.show_total_count&&(t=e.data("total-count"),i.find(".post-feed-header")[1<=t?"removeClass":"addClass"]("hidden"),i.find(".post-feed-header .result-count").text(e.data("display-count"))),(t=i.get(0).closest(".elementor-element")).getBoundingClientRect().top<0&&t.scrollIntoView()):("load_more"===i.data("paginate")?(i.find(".post-feed-grid:first")[1<this.page?"append":"html"](s),(e=i.find("script.info")).data("has-next")?i.find(".feed-pagination .ts-load-more").removeClass("hidden"):i.find(".feed-pagination .ts-load-more").addClass("hidden"),i.find(".ts-no-posts")[e.data("has-results")?"addClass":"removeClass"]("hidden"),this.config.show_total_count&&(t=e.data("total-count"),i.find(".post-feed-header")[1<=t?"removeClass":"addClass"]("hidden"),i.find(".post-feed-header .result-count").text(e.data("display-count-alt")))):(i.find(".post-feed-grid:first").html(s),e=i.find("script.info"),i.find(".ts-no-posts")[e.data("has-results")?"addClass":"removeClass"]("hidden"),this.config.show_total_count&&(t=e.data("total-count"),i.find(".post-feed-header")[1<=t?"removeClass":"addClass"]("hidden"),i.find(".post-feed-header .result-count").text(e.data("display-count")))),e.remove()),i.removeClass("vx-loading"),jQuery(document).trigger("voxel:markup-update"),this.updateMap()},20)}}).fail(()=>{this.loading=!1,this.resetting=!1,t?.removeClass("vx-loading"),i?.removeClass("vx-loading"),Voxel.alert(Voxel_Config.l10n.ajaxError,"error")}),this.config.onSubmit.updateUrl&&((s=new URL(window.location)).search=e,"load_more"===i?.data("paginate")&&s.searchParams.delete("pg"),window.history.replaceState(null,null,s)))},handlePagination(){var e=this.getPostFeedWidget();null!==e&&(e.find(".feed-pagination .ts-load-prev").on("click",e=>{e.preventDefault(),e.target.classList.contains("disabled")||(this.page=1<this.page?this.page-1:1,this.getPosts())}),e.find(".feed-pagination .ts-load-next").on("click",e=>{e.preventDefault(),e.target.classList.contains("disabled")||(this.page+=1,this.getPosts())}),e.find(".feed-pagination .ts-load-more").on("click",e=>{e.preventDefault(),this.page+=1,this.getPosts()}),e.find(".ts-no-posts .ts-feed-reset").on("click",e=>{e.preventDefault(),this.clearAll(),e.currentTarget.classList.remove("resetting"),requestAnimationFrame(()=>e.currentTarget.classList.add("resetting"))}))},handleNavbars(){jQuery(`.ts-nav-sf-${this.widget_id} .ts-item-link`).on("click",e=>{e.preventDefault();e=e.currentTarget.parentElement.dataset.postType;this.setPostType(e)}),this.$watch("post_type",()=>{jQuery(`.ts-nav-sf-${this.widget_id} .menu-item[data-post-type="${this.post_type.key}"]`).addClass("current-menu-item").siblings().removeClass("current-menu-item")})},updateMap(){var s=this.getMapWidget();null!==s&&(this.map?this._updateMarkers():Voxel.Maps.await(()=>{var e=s.find(".ts-map"),t=e.get(0);t&&(e=e.data("config"),t={el:t,zoom:3},(this.mapConfig=e)&&(e.zoom&&(t.zoom=e.zoom),e.minZoom&&(t.minZoom=e.minZoom),e.maxZoom&&(t.maxZoom=e.maxZoom),e.center)&&(t.center=new Voxel.Maps.LatLng(e.center.lat,e.center.lng)),this.map=new Voxel.Maps.Map(t),this.popup=new Voxel.Maps.Popup({map:this.map}),this.mapCircle=new Voxel.Maps.Circle({map:this.map,center:new Voxel.Maps.LatLng(42,20),radius:1}),this.map.addListener("click",()=>this.popup.hide()),this.map.addListenerOnce("idle",()=>{this.map.addListener("idle",this._handleDragSearch),this.searchAreaHandler()}),this._updateMarkers(),this.config.is_edit_mode)&&!this._edit_mode_interval&&(this._edit_mode_interval=setInterval(()=>{var e=this.config.onSubmit.mapId;jQuery(`.elementor-element-${e} .ts-map.ts-map-loaded`).length||(this._mapWidget=null,this.map=null,this.updateMap())},500))}))},_handleDragSearch(){this.getMapWidget().find(".ts-map-drag .ts-drag-toggle.active").length&&!this.suspendDragSearch&&(this.mapCircle.hide(),jQuery(this.$options.el).trigger("map:bounds_updated",this.map.getBounds()))},_updateMarkers(){var e=this.getPostFeedWidget(),n=this.getMapWidget();if(e&&n){this.markers.map(e=>e.remove()),this.markers=[],this.popup.hide(),n.find(".ts-popup-anchor").html("");let l=e.find(".post-feed-grid:first").find("> .ts-preview");this.bounds=new Voxel.Maps.Bounds,this.previewCardCache={},l.length?(e.find(".post-feed-grid:first").removeClass("post-feed-no-results"),l.each((e,r)=>{if("string"==typeof r.dataset.position){let t=r.dataset.postId;var s=r.dataset.position.split(","),i=parseFloat(s[0]),s=parseFloat(s[1]);"number"==typeof i&&"number"==typeof s&&(i=new Voxel.Maps.LatLng(i,s),this.markers.push(new Voxel.Maps.Marker({map:this.map,position:i,template:r.querySelector(":scope > .ts-marker-wrapper").innerHTML,onClick:(e,i)=>{e.stopPropagation(),n.find(".marker-active").removeClass("marker-active"),i.addClass("marker-active");let s=jQuery(this.$refs.mapNavTemplate.innerHTML),a=(s.find(".ts-map-prev").on("click",e=>{e.preventDefault();e=this._prevPost(r.dataset.postId);n.find(`.map-marker[data-post-id="${e}"]`).click()}),s.find(".ts-map-next").on("click",e=>{e.preventDefault();e=this._nextPost(r.dataset.postId);n.find(`.map-marker[data-post-id="${e}"]`).click()}),e=>{var t;1<l.length&&e.append(s.get(0)),"fixed"===this.config.popupAnchor[this.breakpoint]?(this.map.addListenerOnce("click",()=>{i.removeClass("marker-active"),n.find(".ts-popup-anchor").html("")}),this.silentMapUpdate(()=>{this.popup.setPosition(i.getPosition()),this.popup.setContent(jQuery('<div class="empty-popup"></div>').get(0)),this.popup.show()}),(t=jQuery('<div class="gm-style-iw-a ts-marker"><div class="gm-style-iw-t"><div class="gm-style-iw gm-style-iw-c"><div class="gm-style-iw-d"></div></div></div></div>')).find(".gm-style-iw-d").append(e),n.find(".ts-popup-anchor").html(t)):(this.map.addListenerOnce("click",()=>i.removeClass("marker-active")),this.silentMapUpdate(()=>{this.popup.setPosition(i.getPosition()),this.popup.setContent(e),this.popup.show()}))});if(this.post_type.map_template_id&&this.post_type.template_id!==this.post_type.map_template_id){let s=t+":"+this.post_type.map_template_id;this.previewCardCache[s]?(e=jQuery(this.previewCardCache[s]).get(0),a(e)):("fixed"===this.config.popupAnchor[this.breakpoint]&&n.find(".ts-popup-anchor").html(""),this.silentMapUpdate(()=>{this.popup.setPosition(i.getPosition()),this.popup.setContent(jQuery('<div class="ts-preview-popup ts-loading-popup"><span class="ts-loader"></span></div>').get(0)),this.popup.show()}),jQuery.get(`${Voxel_Config.ajax_url}&action=get_preview_card&post_id=${t}&template_id=`+this.post_type.map_template_id).always(e=>{let t=jQuery('<div class="ts-preview-popup"></div>');!1!==e.success&&t.html(e),t=t.get(0),this.previewCardCache[s]=t.outerHTML,a(t)}))}else{e=r.cloneNode(!0);a(e)}}})),this.bounds.extend(i))}})):e.find(".post-feed-grid:first").addClass("post-feed-no-results"),this._mapBoundsHandler(),jQuery(this.$root.$options.el).off("toggled-view:map",this._mapBoundsHandler),jQuery(this.$root.$options.el).one("toggled-view:map",this._mapBoundsHandler)}},_nextPost(e){var t,s=this.getPostFeedWidget();if(s)return t=s.find(".post-feed-grid:first").find("> .ts-preview").first(),((e=(s=s.find(".post-feed-grid:first").find(`> .ts-preview[data-post-id="${e}"]`)).length?s.nextAll(".ts-preview:first"):null)&&e.length?e:t).data("post-id")},_prevPost(e){var t,s=this.getPostFeedWidget();if(s)return t=s.find(".post-feed-grid:first").find("> .ts-preview").last(),((e=(s=s.find(".post-feed-grid:first").find(`> .ts-preview[data-post-id="${e}"]`)).length?s.prevAll(".ts-preview:first"):null)&&e.length?e:t).data("post-id")},_mapBoundsHandler(){var e=Object.values(this.post_type.filters).find(e=>"location"===e.type);e&&null!==e.value||this.silentMapUpdate(()=>{this.bounds.empty()?(this.map.setCenter(new Voxel.Maps.LatLng(this.mapConfig.center.lat,this.mapConfig.center.lng)),this.map.setZoom(this.mapConfig.zoom)):(this.map.fitBounds(this.bounds),setTimeout(()=>{this.map.getZoom()>this.mapConfig.maxZoom&&this.map.setZoom(this.mapConfig.maxZoom),this.map.getZoom()<this.mapConfig.minZoom&&this.map.setZoom(this.mapConfig.minZoom)}))})},silentMapUpdate(e){this.suspendDragSearch=!0,e(),this.map.addListenerOnce("idle",()=>this.suspendDragSearch=!1)},clearAll(){this.resetting=!0,Object.values(this.post_type.filters).forEach(e=>{e.value=e.resets_to;e=this.$refs[this.post_type.key+":"+e.key];e&&"function"==typeof e.onReset&&e.onReset()}),this.mapCircle?.hide(),"filter_update"!==this.config.searchOn&&this.getPosts();let e=this.$refs.resetBtn;e&&(e.classList.remove("resetting"),requestAnimationFrame(()=>e.classList.add("resetting")))},_shortenPoint(e){return e.toString().substr(0,e<0?9:8)},getPostFeedWidget(){var e;return"post-to-feed"!==this.config.onSubmit.action?null:(this._postFeedWidget||(e=this.config.onSubmit.postFeedId,(e=jQuery(".elementor-element-"+e)).length&&(this._postFeedWidget=e)),this._postFeedWidget)},getMapWidget(){var e;return"post-to-feed"!==this.config.onSubmit.action?null:(this._mapWidget||(e=this.config.onSubmit.mapId,(e=jQuery(".elementor-element-"+e)).length&&((this._mapWidget=e).find(".ts-map-drag .ts-drag-toggle").on("click",e=>{e.preventDefault(),e.currentTarget.classList.toggle("active")}),e.find(".ts-map-drag .ts-search-area").on("click",e=>{e.preventDefault(),e.currentTarget.classList.add("hidden"),this.mapCircle?.hide(),jQuery(this.$options.el).trigger("map:bounds_updated",this.map.getBounds()),this.searchAreaHandler()}))),this._mapWidget)},searchAreaHandler(){let e=this.getMapWidget()?.find(".ts-map-drag .ts-search-area");e&&e.length&&this.map&&(e.data("next-handler")||(e.data("next-handler",!0),this.map.addListenerOnce("idle",()=>{e.removeClass("hidden"),e.data("next-handler",!1)})))},getLocationFilter(){var e=Object.values(this.post_type.filters).find(e=>"location"===e.type);return e?this.$refs[this.post_type.key+":"+e.key]:null},setActiveBreakpoint(){var e=elementorFrontendConfig.responsive.breakpoints;let t=matchMedia(`screen and (max-width: ${e.mobile.value}px)`),s=matchMedia(`screen and (min-width: ${e.tablet.value+1}px)`);this.breakpoint=t.matches?"mobile":s.matches?"desktop":"tablet",t.addListener(()=>this.breakpoint=t.matches?"mobile":s.matches?"desktop":"tablet"),s.addListener(()=>this.breakpoint=t.matches?"mobile":s.matches?"desktop":"tablet")},toggleListView(e){var t=this.breakpoint;this.$refs.listViewToggle.classList.add("vx-hidden-"+t),this.getMapWidget()?.addClass("vx-hidden-"+t),this.$refs.mapViewToggle.classList.remove("vx-hidden-"+t),this.getPostFeedWidget()?.removeClass("vx-hidden-"+t),jQuery(this.$options.el).trigger("toggled-view:list",this.map.getBounds())},toggleMapView(e){var t=this.breakpoint;this.$refs.listViewToggle.classList.remove("vx-hidden-"+t),this.getMapWidget()?.removeClass("vx-hidden-"+t),this.$refs.mapViewToggle.classList.add("vx-hidden-"+t),this.getPostFeedWidget()?.addClass("vx-hidden-"+t);let s=this.getMapWidget()?.find(".ts-map-drag .ts-search-area");s.data("first-handler")||(s.data("first-handler",!0),this.map.addListenerOnce("idle",()=>{s?.addClass("hidden"),this.searchAreaHandler()})),jQuery(this.$options.el).trigger("toggled-view:map",this.map.getBounds()),"mapbox"===Voxel_Config.maps.provider&&this.map.getSourceObject().resize()},_blur_portal(e){this.portal.active&&this.portal.enabled[this.breakpoint]&&(e.target.closest(".triggers-blur, .vx-popup:not(.ts-search-portal)")||(this.portal.active=!1))}},computed:{currentValues(){var s;return this.post_type?(s={},Object.keys(this.post_type.filters).forEach(e=>{var t=this.post_type.filters[e].value;null!==t&&(s[e]=t)}),s):null},currentQueryString(){this.getPostFeedWidget();var s={type:this.post_type.key};return Object.keys(this.post_type.filters).forEach(e=>{var t=this.post_type.filters[e].value;null!==t&&(s[e]=t)}),1<this.page&&(s.pg=this.page),jQuery.param(s).replace(/%2C/g,",").replace(/%3B/g,";").replace(/%20/g,"+")},activeFilterCount(){return Object.values(this.currentValues).filter(e=>null!==e).length}}})})(e)).component("form-group",Voxel.components.formGroup),t.component("term-list",h),t.component("filter-post-types",s),t.component("filter-keywords",i),t.component("filter-stepper",a),t.component("filter-range",r),t.component("filter-location",l),t.component("filter-availability",n),t.component("filter-open-now",o),t.component("filter-terms",d),t.component("filter-order-by",p),t.component("filter-recurring-date",u),t.component("filter-date",u),t.component("filter-switcher",c),t.component("filter-user",v),t.component("filter-relations",f),t.component("filter-post-status",m),t.component("filter-ui-heading",g),t.mount(e))})},window.render_search_form(),jQuery(document).on("voxel:markup-update",window.render_search_form)});
