!function(e){"function"==typeof define&&define.amd?define("commons",e):e()}(function(){"use strict";window.Voxel={mixins:{},components:{},Maps:{await(e){Voxel.Maps.Loaded?e():document.addEventListener("maps:loaded",()=>e())}},helpers:{getParent(e,t){for(var o=null,r=e.$parent;r&&!o;)r.$options.name===t&&(o=r),r=r.$parent;return o},dateFormatYmd(e){return[e.getFullYear(),("0"+(e.getMonth()+1)).slice(-2),("0"+e.getDate()).slice(-2)].join("-")},dateTimeFormat(e){return e.toLocaleString(void 0,{dateStyle:"medium",timeStyle:"short"})},dateFormat(e){return e.toLocaleString(void 0,{dateStyle:"medium"})},timeFormat(e){return e.toLocaleString(void 0,{timeStyle:"short"})},currencyFormat(t){try{return new Intl.NumberFormat(Voxel_Config.locale.replace("_","-"),{style:"currency",currency:Voxel_Config.currency}).format(t)}catch(e){return Voxel_Config.currency+" "+t}},debounce(t,o=200){let r;return(...e)=>{clearTimeout(r),r=setTimeout(()=>{t.apply(this,e)},o)}},viewportPercentage(e){var t,o,e=e.getBoundingClientRect(),r=window.innerHeight;return e.top>=r||e.bottom<=0?0:e.top<0&&e.bottom>r?1:(t=e.top<0?Math.abs(e.top):0,o=e.bottom>r?e.bottom-r:0,(e.height-t-o)/r)},sequentialId(){return this.count||(this.count=1),this.count++}},alert(e,t="info",o=[],r=7500){var t=document.getElementById("vx-alert-tpl").textContent.replace("{type}",t).replace("{message}",e),a=jQuery(t).hide();Array.isArray(o)&&o.length?o.forEach(e=>{e=jQuery('<a class="ts-btn ts-btn-4">').attr("href",e.link).html(e.label);a.find(".alert-actions").append(e)}):a.find(".alert-actions").remove(),a.find(".close-alert").on("click",e=>{e.preventDefault(),a.fadeOut(100,()=>a.remove())}),"number"==typeof r&&0<r&&setTimeout(()=>a.fadeOut(100,()=>a.remove()),r),jQuery("#vx-alert").html(a),a.fadeIn(100)},authRequired(e=null){null===e&&(e=Voxel_Config.l10n.accountRequired),Voxel.alert(e,"info",[{link:Voxel_Config.login_url,label:Voxel_Config.l10n.login},{link:Voxel_Config.register_url,label:Voxel_Config.l10n.register}],7500)},requireAuth(e){Voxel_Config.is_logged_in||(e.preventDefault(),Voxel.authRequired())},getSearchParam(e){return new URL(window.location).searchParams.get(e)},setSearchParam(e,t){var o=new URL(window.location);o.searchParams.set(e,t),window.history.replaceState(null,null,o)},localStore(t,o,e){try{localStorage.setItem(t,o)}catch(e){localStorage.removeItem(t);try{Voxel.cacheDB.set(t,o)}catch(e){}}o={};try{var r=JSON.parse(localStorage.getItem("voxel:ttls"));"object"==typeof r&&null!==r&&(o=r)}catch(e){}o[t]={start:(new Date).getTime(),ttl:e},localStorage.setItem("voxel:ttls",JSON.stringify(o))},cacheDB:{do(r){var a=indexedDB.open("voxel",1);a.onupgradeneeded=function(){a.result.createObjectStore("cache",{keyPath:"key"})},a.onsuccess=function(){var e=a.result,t=e.transaction("cache","readwrite"),o=t.objectStore("cache");r(o),t.oncomplete=()=>e.close()}},get(o,r){Voxel.cacheDB.do(e=>{let t=e.get(o);t.onsuccess=()=>{r(t.result?.value)}})},set(t,o){Voxel.cacheDB.do(e=>{e.put({key:t,value:o})})},delete(t){Voxel.cacheDB.do(e=>{e.delete(t)})}},deleteSearchParam(e){var t=new URL(window.location);t.searchParams.delete(e),window.history.replaceState(null,null,t)},async share(e){try{await navigator.share(e)}catch(e){}},copy(e){navigator.clipboard.writeText(e).then(()=>Voxel.alert(Voxel_Config.l10n.copied,"info",null,1500))},loadTab(e,r,a){e.preventDefault();let l=document.querySelector(`.ts-template-tabs-${CSS.escape(r)} .ts-template-tab[data-tab="${CSS.escape(a)}"]`);if(l){let e=l.closest(".ts-template-tabs"),t=JSON.parse(e.dataset.config),o=(jQuery(`.ts-tab-triggers-${CSS.escape(r)} .menu-item`).removeClass("current-menu-item"),jQuery(`.ts-tab-triggers-${CSS.escape(r)} .menu-item[data-tab="${CSS.escape(a)}"]`).addClass("current-menu-item"),e=>{jQuery(e).siblings().removeClass("active-tab"),e.classList.add("active-tab"),t.default_tab===e.dataset.tab?Voxel.deleteSearchParam(t.url_key):Voxel.setSearchParam(t.url_key,e.dataset.tab)});l.classList.contains("rendered")?o(l):(e.classList.add("vx-pending"),jQuery.get(Voxel_Config.ajax_url,{action:"tabs.load",post_id:t.post_id,widget_id:t.widget_id,template_id:t.template_id,tab:a}).always(t=>{if(e.classList.remove("vx-pending"),!1===t.success)Voxel.alert(t.message||Voxel_Config.l10n.ajaxError,"error");else{let e=jQuery(t);e.find('script, link[rel="stylesheet"]').each((e,t)=>{t.id&&document.querySelector("#"+CSS.escape(t.id))&&t.remove()}),e.appendTo("#vx-markup-cache"),setTimeout(()=>{e.appendTo(jQuery(l)),l.classList.add("rendered"),o(l),jQuery(document).trigger("voxel:markup-update")},20)}}))}},scrollTo(e){e&&window.scrollTo({top:e.getBoundingClientRect().top+window.pageYOffset,behavior:"smooth"})}},window.Voxel.mixins.base={data(){return{widget_id:null,post_id:null}},mounted(){this.widget_id=this.$root.$options.el.closest(".elementor-element").dataset.id,this.post_id=this.$root.$options.el.closest(".elementor").dataset.elementorId},computed:{$w(){return window}}},window.Voxel.mixins.blurable={props:{preventBlur:{type:String,default:""}},mounted(){requestAnimationFrame(()=>{document.addEventListener("mousedown",this._click_outside_handler)})},unmounted(){document.removeEventListener("mousedown",this._click_outside_handler)},methods:{_click_outside_handler(e){var t=".triggers-blur";this.preventBlur.length&&(t+=","+this.preventBlur),e.target.closest(t)||this.$emit("blur")}}},window.Voxel.mixins.popup={data(){return{styles:""}},mounted(){let o=this.target;if(o="string"==typeof o?document.querySelector(o):o){var r=o.getBoundingClientRect(),a=this.$refs["popup-box"],l=jQuery(o).offset(),n=jQuery(o).outerWidth(),a=Math.max(r.width,parseFloat(window.getComputedStyle(a).minWidth)),s=jQuery("body").innerWidth(),n=Math.max(s-l.left-n,0),n=s-15<n+a?s-a-15:n;let e="left: "+(l.left+a>s-15?s-a-15:l.left)+"px;",t=("rtl"===document.documentElement.getAttribute("dir")&&(e="right: "+n+"px;"),`top: ${l.top+r.height}px;`);s=window.innerHeight,n=this.$refs.popup.getBoundingClientRect();r.bottom+n.height>s&&0<=r.top-n.height&&(t=`top: ${l.top-n.height}px;`),this.styles=`
				${t}
				${e}
				width: ${a}px;
				position: absolute;
			`}requestAnimationFrame(()=>{var e=this.$el.querySelector(".autofocus");e&&e.focus()})}},window.Voxel.components.popup={template:"#voxel-popup-template",mixins:[Voxel.mixins.blurable,Voxel.mixins.popup],props:{onBlur:Function,target:[Object,String],saveLabel:String,clearLabel:String,controllerClass:String,showSave:{type:Boolean,default:!0},showClear:{type:Boolean,default:!0},showClose:{type:Boolean,default:!1}}},window.Voxel.components.formGroup={template:"#voxel-form-group-template",props:{popupKey:String,saveLabel:String,clearLabel:String,wrapperClass:String,controllerClass:String,showSave:{type:Boolean,default:!0},showClear:{type:Boolean,default:!0},showClose:{type:Boolean,default:!1},defaultClass:{type:Boolean,default:!0},preventBlur:{type:String,default:""},tag:{type:String,default:"div"}},components:{"form-popup":window.Voxel.components.popup},data(){return{popupTarget:null}},mounted(){this.popupTarget=this.$el.querySelector(".ts-popup-target")||this.$el},methods:{blur(){this.$refs.popup.$emit("blur")},onPopupBlur(){this.$root.activePopup=null,this.$emit("blur",this)}}},window.render_static_popups=()=>{Array.from(document.querySelectorAll(".ts-popup-component")).forEach(e=>{var t;e.__vue_app__||((t=Vue.createApp({template:e.innerHTML,data(){return{active:!1,screen:"main",widget_id:null,post_id:null,slide_from:"left",window:window,navigator:window.navigator,Voxel:window.Voxel}},mounted(){this.widget_id=this.$el.parentElement.closest(".elementor-element").dataset.id,this.post_id=this.$el.parentElement.closest(".elementor").dataset.elementorId,this.$refs.target.onclick=e=>{e.preventDefault(),this.active=!0}},methods:{beforeEnter(e){setTimeout(()=>e.closest(".min-scroll").scrollTop=e.dataset.scrollTop||0,100)},beforeLeave(e){e.dataset.scrollTop=e.closest(".min-scroll").scrollTop}}})).component("form-popup",{template:`
				<div class="elementor vx-popup" :class="'elementor-'+$root.post_id">
					<div class="ts-popup-root elementor-element" :class="'elementor-element-'+$root.widget_id+'-wrap'" v-cloak>
						<div class="ts-form ts-search-widget elementor-element" :style="styles" ref="popup" :class="'elementor-element-'+$root.widget_id">
							<div class="ts-field-popup-container">
								<div class="ts-field-popup triggers-blur" ref="popup-box">
									<div class="ts-popup-content-wrapper min-scroll">
										<slot></slot>
									</div>
									<slot name="footer"></slot>
								</div>
							</div>
						</div>
					</div>
				</div>
			`,mixins:[Voxel.mixins.blurable,Voxel.mixins.popup],props:["onBlur","target"]}),t.component("popup",{props:["wrapper"],template:`
				<teleport to="body">
				 	<transition name="form-popup">
				 		<form-popup v-if="$root.active" ref="popup" @blur="$root.active = false" :target="$root.$refs.target" :class="wrapper">
				 			<template #default>
								<slot></slot>
				 			</template>
				 			<template #footer>
								<slot name="footer"></slot>
				 			</template>
				 		</form-popup>
				 	</transition>
				</teleport>
			`,methods:{blur(){this.$refs.popup.$emit("blur")}}}),t.mount(e))})},window.render_static_popups(),jQuery(document).on("voxel:markup-update",window.render_static_popups);let t=o=>{o(".ts-expand-hours:not(.vx-event-expand)").each((e,t)=>{t.classList.add("vx-event-expand"),o(t).on("click",e=>{e.preventDefault(),o(t).parents(".ts-work-hours").toggleClass("active")})}),o(".ts-action-follow:not(.vx-event-follow)").each((e,t)=>{t.classList.add("vx-event-follow"),o(t).on("click",o=>{if(o.preventDefault(),!Voxel_Config.is_logged_in)return Voxel.authRequired();o.currentTarget.classList.add("vx-pending"),jQuery.get(o.currentTarget.href).always(e=>{var t;e.success?o.currentTarget.classList.toggle("active"):(t=Voxel_Config.l10n.ajaxError,e=e.message||t,Voxel.alert(e,"error")),o.currentTarget.classList.remove("vx-pending")})})}),o(".post-feed-nav a:not(.vx-event-nav)").each((e,t)=>{t.classList.add("vx-event-nav"),o(t).on("click",e=>{e.preventDefault();var t,e=e.currentTarget,o=e.classList.contains("prev-page")?"prev":"next",e=e.closest(".elementor-widget-container");e&&(e=e.querySelector(".post-feed-grid"))&&(t=e.querySelector(".ts-preview"))&&(t=t.scrollWidth,e.scrollBy({left:"prev"==o?-t:t,behavior:"smooth"}))})}),o(".elementor-widget-ts-post-feed .post-feed-grid").on("scroll",Voxel.helpers.debounce(e=>{var t,e=e.currentTarget,o=e.closest(".elementor-widget-container");o&&e.querySelector(".ts-preview")&&(t=o.querySelector(".post-feed-nav .prev-page"),o=o.querySelector(".post-feed-nav .next-page"),1<=Math.abs(e.scrollLeft)?t.classList.remove("disabled"):t.classList.add("disabled"),e.offsetWidth+Math.abs(e.scrollLeft)+10>=e.scrollWidth?o.classList.add("disabled"):o.classList.remove("disabled"))},100)),o(".ts-plan-tabs a:not(.vx-event-plans)").each((e,t)=>{t.classList.add("vx-event-plans"),o(t).on("click",e=>{e.preventDefault();var t=e.target.dataset.id,e=o(e.target.parentElement),e=(e.addClass("ts-tab-active").siblings().removeClass("ts-tab-active"),e.parent().next());e.find(`.ts-plan-container:not([data-group="${t}"])`).addClass("hidden"),e.find(`.ts-plan-container[data-group="${t}"]`).removeClass("hidden")})}),o("a[vx-action]:not(.vx-event-action)").each((e,t)=>{t.classList.add("vx-event-action"),o(t).on("click",o=>{var e;o.preventDefault(),o.currentTarget.dataset.confirm&&!confirm(o.currentTarget.dataset.confirm)||(o.currentTarget.classList.add("vx-pending"),e=o.currentTarget.href,jQuery.get(e,e=>{if(e.success){if(e.message&&Voxel.alert(e.message,e.message_type||"success"),e.redirect_to)return"(reload)"===e.redirect_to?location.reload():window.location.href=e.redirect_to,void o.currentTarget.classList.remove("vx-pending")}else{var t=Voxel_Config.l10n.ajaxError,e=e.message||t;Voxel.alert(e,"error")}o.currentTarget.classList.remove("vx-pending")}).fail(()=>{var e=Voxel_Config.l10n.ajaxError,e=response.message||e;Voxel.alert(e,"error"),o.currentTarget.classList.remove("vx-pending")}))})}),o(".ts-nav-menu.ts-custom-links:not(.vx-event-links)").each((e,t)=>{t.classList.add("vx-event-links"),o(t).each((e,t)=>{let a={};o(t).find('.ts-item-link[href^="#"]').each((e,t)=>{try{var o=t.attributes.href.value,r=document.querySelector(o);r&&(a[o]={section:r,toggle:t})}catch(e){}}),Object.values(a).length&&(t=()=>{let t=[];Object.values(a).forEach(e=>{t.push({target:e,pct:Voxel.helpers.viewportPercentage(e.section)})}),t.sort((e,t)=>t.pct-e.pct);var e=t[0];e&&e.pct&&o(e.target.toggle).parent().addClass("current-menu-item").siblings().removeClass("current-menu-item")},o(window).on("scroll",Voxel.helpers.debounce(t,100)),t())})}),o(".vx-guest-plan:not(.vx-event-plan)").each((e,t)=>{t.classList.add("vx-event-plan"),o(t).on("click",e=>{Voxel.setSearchParam("checkout.plan",btoa(e.currentTarget.dataset.priceKey))})})};jQuery(e=>t(e)),jQuery(document).on("voxel:markup-update",()=>t(jQuery)),jQuery(e=>{if(jQuery(document).on("voxel:markup-update",()=>{jQuery(".elementor-widget-image-carousel").each((e,t)=>{elementorFrontend.elementsHandler.runReadyTrigger(t)})}),document.querySelector("body.logged-in .ts-plans-list.allow-autoselect"))try{var t,o,r;Voxel.getSearchParam("checkout.plan")?(t=atob(Voxel.getSearchParam("checkout.plan")),document.querySelector(`.vx-pick-plan[data-price-key="${CSS.escape(t)}"]`)?.click(),Voxel.deleteSearchParam("checkout.plan")):Voxel.getSearchParam("redirect_to")&&(o=new URL(Voxel.getSearchParam("redirect_to"))).searchParams.get("checkout.plan")&&(r=atob(o.searchParams.get("checkout.plan")),document.querySelector(`.vx-pick-plan[data-price-key="${CSS.escape(r)}"]`)?.click())}catch(e){}setTimeout(()=>{try{let o=JSON.parse(localStorage.getItem("voxel:ttls"));"object"==typeof o&&null!==o&&(Object.keys(o).forEach(e=>{var t=o[e];((new Date).getTime()-t.start)/1e3>t.ttl&&(localStorage.removeItem(e),Voxel.cacheDB.delete(e),delete o[e])}),localStorage.setItem("voxel:ttls",JSON.stringify(o)))}catch(e){}},2e3)})});
